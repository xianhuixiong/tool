# Personal Cloud Storage (代理模式)

这是一个使用 **Node.js** 和 **Express** 框架实现的个人云存储项目，支持常用文件的上传、下载、查看、重命名和删除操作。项目不需要登录，也没有上传大小限制，适合作为私人文件存储或团队内部共享使用。为了演示 **代理模式**，文件操作相关的逻辑被封装在 `FileService` 类中，并通过 `FileServiceProxy` 代理进行访问，代理在实际调用服务前输出日志记录，展示了代理模式如何在不修改核心业务代码的情况下添加扩展功能。

## 功能特点

- **上传文件**：通过表单上传任意格式的文件到服务器。
- **查看文件列表**：查看所有上传的文件，包括名称、大小、上传时间等信息。
- **下载文件**：点击下载链接可将文件保存到本地。
- **重命名文件**：支持修改文件名称（仅修改数据库中记录，不改变实际文件名）。
- **删除文件**：删除数据库记录并同时删除服务器磁盘上的文件。
- **代理模式示例**：核心文件操作由 `services/fileService.js` 实现，`services/fileServiceProxy.js` 通过代理模式包装该服务并在每次调用时记录日志，方便后期扩展（如权限控制、缓存等）。

## 项目结构

```
tool/
├── app.js                 # 应用入口，配置 Express、路由及文件上传
├── package.json           # 项目依赖及运行脚本
├── .gitignore             # 忽略目录
├── public/
│   └── index.html         # 前端页面：上传、查看、重命名与删除文件
└── services/
    ├── fileService.js     # 文件服务，封装数据库及文件系统操作
    └── fileServiceProxy.js# 文件服务代理，演示代理模式
```

## 快速开始

1. **安装依赖**

   ```bash
   cd tool
   npm install
   ```

2. **启动应用**

   ```bash
   node app.js
   ```

   服务器默认监听 `3000` 端口，也可以通过设置环境变量 `PORT` 指定其他端口，例如：

   ```bash
   PORT=4000 node app.js
   ```

3. **访问应用**

   打开浏览器访问 [http://localhost:3000](http://localhost:3000)，即可看到上传表单和文件列表。上传文件后，列表会显示文件信息，并提供下载、重命名和删除操作。

## 代理模式说明

本项目为了演示设计模式中的 **代理模式**，在 `services/fileService.js` 中实现了与文件相关的核心操作，包括：

- 初始化 SQLite 数据库并创建 `files` 表；
- 保存上传文件元数据；
- 查询、重命名和删除文件记录；
- 物理删除磁盘上的文件；

`services/fileServiceProxy.js` 实现了同样的接口，但在每个方法调用前打印出操作日志，然后再调用真实的 `FileService`。这样可以在不修改核心逻辑的情况下添加统一的前置处理逻辑。这也是代理模式常见的用途之一，可以用于记录访问、缓存、权限校验、事务控制等场景。

## 提示

- 默认情况下，上传的文件存储在 `uploads/` 目录，数据库文件为 `files.db`，二者均被 `.gitignore` 忽略。
- 若在生产环境部署，建议使用反向代理（如 Nginx）和 HTTPS；还可以考虑将文件存储迁移到对象存储服务（如 S3、阿里云 OSS），并添加用户认证机制。

## License

本项目以 MIT License 开源，欢迎学习和修改。